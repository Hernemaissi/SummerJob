<%= provide(:title, "Contract")%>
<%= stylesheet_link_tag "contracts.css" %> 
<% if @contract.under_negotiation && !current_user.teacher? && current_user.company == @contract.negotiation_receiver %>
<div class="alpha60"> <%end%>
<%= form_for(@contract) do |f| %>
          <%= render 'shared/negotiation_eror_messages', :object => f.object %>
<br/>
<h1> CONTRACT</h1>
<p3> <u><%= @contract.service_buyer.name%></u>, known as "First Party," agrees to enter into this contract with <u><%= @contract.service_provider.name %></u> , known as "Second Party" on {date}.
This agreement is based on the following terms: <br/><br/>
1. $<%= @contract.bid.offer %><br/><br/>
2. Amount of launches: <%= @contract.bid.launches %><br/><br/>
3. Contract duration: <%= (@contract.bid.agreed_duration) ? @contract.bid.agreed_duration.to_s + " years" : "Whole game" %> <% if @contract.bid.agreed_duration %>  (Remaining duration: <%= @contract.bid.remaining_duration %>) <% end %> <br/><br/>
4. Penalty for breaking contract: <%= @contract.bid.penalty %> <br/><br/>
Furthermore, the First Party agrees:{other items applicable to the First Party} and the Second Party agrees:{other items applicable to the Second Party} .
Invalidity or unenforceability of one or more provisions of this agreement shall not affect any other provision of this agreement.
This agreement is subject to the laws and regulations of the state of Aalto University. <br/><br/><br/>
Signed: <br/>
<br/>
<u><%= @contract.service_buyer.name %></u></br>
{First Party Name}<br/><br/>
<em><u> <p4><%= @contract.service_buyer.name%> </p4></u></em><br/>
{First Party Signature}<br/>
<br/>
<br/>
<u><%= @contract.service_provider.name %></u><br/>
{Second Party Name}<br/><br/>
<em><u> <p4><%= @contract.service_provider.name %></p4> </u></em> <br/>
{Second Party Signature}

<br/><br/><br/><br/><br/>

<% if @contract.under_negotiation && !current_user.teacher? && current_user.company == @contract.negotiation_sender %>
<p>The other company is still considering your proposal.</p>
<% end %>


<% unless @contract.under_negotiation || current_user.teacher? %>

<% if !current_user.teacher? %> 
<div class="createbuttonarea">
<a class="btn" data-toggle="modal" href="#myModal">Re-negotiate contract</a>
<%end%></div>

<div class="modal hide fade" id="myModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>Re-negotiation form</h3>
  </div>
  <div class="modal-body">
    <div>
       
          <%= f.label :new_amount, "New Price" %>
          <div class="fieldarea">
            <%= f.text_field :new_amount %>
         </div>

      <%= f.label :new_duration, "New Duration (leave empty for no duration)" %>
          <div class="fieldarea">
            <%= f.text_field :new_duration, :value => @contract.bid.remaining_duration %>
         </div>

      <%= f.label :new_launches, "New amount of launches" %>
          <div class="fieldarea">
            <%= f.text_field :new_launches, :value => @contract.bid.launches %>
         </div>


       <input type="hidden" name="type" value="<%= Contract.renegotiation %>" class="negotiation_type"/>
       </div>


  <div class="modal-footer">
    <a href="#">
      <div class="fieldarea">
      <%= f.submit "Send re-negotiation request", class: "btn btn-primary" %></div>
    <% end %>
  <% end %>
 </div></a>
  </div>
</div>
<% unless current_user.teacher? %>
<div class="createbuttonarea">
<a class="btn" data-toggle="modal" href="#endContractModal">End Contract</a>
</div>

<div class="modal hide fade" id="endContractModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>End Contract</h3>
  </div>
  <div class="modal-body">
    <div id="end_contract_body">

      <p> There are two ways to end the contract: </p>
      <ul>
        <li> Ask the other party to mutually end the contract, there is no penalty. </li>
        <li> Break the contract, ending it immediately. You have to pay the penalty </li>
      </ul>

       </div>
<%= form_for(@contract) do |f| %>
    <input type="hidden" name="type" value="<%= Contract.end_contract %>" class="negotiation_type"/>

  <div class="modal-footer">
    <a href="#">
      <div class="fieldarea">
       <%= f.submit "Send contract end request", class: "btn btn-primary" %>
        <% end %>
      <%= link_to "Break Contract", @contract, :confirm => "Are you sure?", :method => :delete,  :class => "btn btn-danger"%></div>

 </div></a>
  </div>
</div>
<% end %>

<% if @contract.under_negotiation && !current_user.teacher? && current_user.company == @contract.negotiation_receiver %>
<% if @contract.negotiation_type == Contract.renegotiation %>
<div class="alpha60">
<div class="modal show" id="myModal">

   <div class="modal-header">
   <p1>  <%= @contract.negotiation_sender.name %> wishes to re-negotiate the contract with following changes: </p1>
   </div>

   <div class="modal-body">
   <p1 style="color:black">  New Price per launch: <%= @contract.new_amount %> </p1> <br/><br/>
   <p1 style="color:black">  New Duration for contract: <%= @contract.new_duration ? @contract.new_duration : "Whole Game" %> </p1> <br/><br/>
   <p1 style="color:black">  New amount of launches: <%= @contract.new_launches %> </p1> <br/><br/>
  </div>

  <div class="modal-footer">
  <div id="acceptbuttoncontract">
     <%= form_tag contract_decision_path do %>
     <%= hidden_field_tag("decision", "ACC") %>
     <%= submit_tag "Accept", class: "btn btn-success" %>
     <% end %>
  </div>
  <div id="rejectbuttoncontract">
      <%=  form_tag contract_decision_path do  %>
      <%= hidden_field_tag("decision", "REJ") %>
      <%= submit_tag "Decline", class: "btn btn-danger" %>
      <% end %>
   </div>  
   </div>
</div>
</div>

<% else %>

<div class="alpha60">
<div class="modal show" id="myModal">

   <div class="modal-header">
   <p1>  <%= @contract.negotiation_sender.name %> wishes to end the contract: </p1>
   </div>

   <div class="modal-body">
   <p1 style="color:black">  If you accept, the current contract will end. </p1> <br/><br/>
  </div>

  <div class="modal-footer">
  <div id="acceptbuttoncontract">
     <%= form_tag contract_decision_path do %>
     <%= hidden_field_tag("decision", "ACC") %>
     <%= submit_tag "Accept", class: "btn btn-success" %>
     <% end %>
  </div>
  <div id="rejectbuttoncontract">
      <%=  form_tag contract_decision_path do  %>
      <%= hidden_field_tag("decision", "REJ") %>
      <%= submit_tag "Decline", class: "btn btn-danger" %>
      <% end %>
   </div>
   </div>
</div>
</div>

<% end %>

<% end %>

<% if @contract.negotiation_sender != nil && !@contract.under_negotiation && !current_user.teacher? && current_user.company == @contract.negotiation_sender && !@decision_seen %>
<!-- Button trigger modal -->
<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#decisionModal">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="decisionModal" tabindex="-1" role="dialog" aria-labelledby="decisionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="decisionModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<% end %>


